<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ultra Real AI</title>
  <style>
    body{font-family:Arial, sans-serif; max-width:960px; margin:0 auto; padding:24px;}
    .box{border:1px solid #ddd; border-radius:12px; padding:16px; margin:12px 0;}
    input, textarea, button, select{width:100%; padding:10px; margin:8px 0; border-radius:10px; border:1px solid #ccc;}
    button{cursor:pointer; font-weight:bold;}
    .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px;}
    .item{border:1px solid #eee; border-radius:12px; padding:10px;}
    img, video{width:100%; border-radius:12px;}
    .row{display:flex; gap:10px;}
    .row > *{flex:1;}
    .small{font-size:12px; color:#666;}
    .ok{color:#0a7;}
    .warn{color:#c60;}
  </style>
</head>
<body>
  <h1>ðŸ”¥ Ultra Real AI</h1>
  <p class="small">
    Fluxo: 1) Crie um personagem (rosto fixo) â†’ 2) Gere novas imagens mantendo o rosto â†’ 3) (Opcional) VÃ­deo.
  </p>

  <div class="box">
    <h2>1) Criar personagem (ultra-realista)</h2>
    <form id="createCharacterForm">
      <textarea name="description" rows="3" placeholder="Descreva o personagem (ex.: mulher 28 anos, pele oliva com sardas sutis, cabelo castanho ondulado, estilo wellness, expressÃ£o confiante)"></textarea>
      <div class="row">
        <select name="size">
          <option value="1024x1024">1024x1024</option>
          <option value="1536x1024">1536x1024</option>
          <option value="1024x1536">1024x1536</option>
        </select>
        <button type="submit">Criar personagem</button>
      </div>
    </form>
    <div id="createResult"></div>
  </div>

  <div class="box">
    <h2>2) Nova imagem com o MESMO rosto</h2>
    <form id="newImageForm">
      <input name="character_id" placeholder="Cole aqui o character_id do personagem" />
      <textarea name="scene" rows="3" placeholder="Descreva a nova cena (ex.: em um escritÃ³rio moderno, luz do fim da tarde, roupa social, olhando para a cÃ¢mera)"></textarea>
      <div class="row">
        <select name="size">
          <option value="1024x1024">1024x1024</option>
          <option value="1536x1024">1536x1024</option>
          <option value="1024x1536">1024x1536</option>
        </select>
        <button type="submit">Gerar nova imagem</button>
      </div>
      <p class="small warn">Dica: consistÃªncia mÃ¡xima acontece quando a rota usa a imagem como referÃªncia (image-to-image).</p>
    </form>
    <div id="imageResult"></div>
  </div>

  <div class="box">
    <h2>3) VÃ­deo com o MESMO rosto (opcional)</h2>
    <form id="videoForm">
      <input name="character_id" placeholder="character_id" />
      <textarea name="prompt" rows="3" placeholder="Prompt do vÃ­deo (ex.: cÃ¢mera se aproxima, sorriso sutil, movimento natural, iluminaÃ§Ã£o realista)"></textarea>
      <button type="submit">Gerar vÃ­deo</button>
      <p class="small warn">
        Se sua conta nÃ£o tiver endpoint de vÃ­deo habilitado, esta rota vai avisar. Eu te ajudo a ativar ou integrar outro provedor.
      </p>
    </form>
    <div id="videoResult"></div>
  </div>

  <div class="box">
    <h2>Galeria (arquivos gerados)</h2>
    <div class="grid">
      {% for item in items %}
        <div class="item">
          <div class="small">{{ item }}</div>
          {% if item.endswith(".mp4") %}
            <video controls src="/media/{{ item }}"></video>
          {% else %}
            <img src="/media/{{ item }}" />
          {% endif %}
          <a href="/api/download/{{ item }}"><button>Baixar</button></a>
        </div>
      {% endfor %}
    </div>
  </div>

<script>
async function postForm(url, formEl){
  const fd = new FormData(formEl);
  const res = await fetch(url, { method:"POST", body: fd });
  const data = await res.json();
  if(!res.ok) throw data;
  return data;
}

document.getElementById("createCharacterForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const out = document.getElementById("createResult");
  out.innerHTML = "Gerando...";
  try{
    const data = await postForm("/api/character/create", e.target);
    out.innerHTML = `
      <p class="ok"><b>Personagem criado!</b></p>
      <p><b>character_id:</b> <code>${data.character_id}</code></p>
      <img src="${data.ref_image}" style="max-width:420px;border-radius:12px" />
      <p><a href="${data.download}">Baixar imagem</a></p>
    `;
  }catch(err){
    out.innerHTML = `<pre>${JSON.stringify(err,null,2)}</pre>`;
  }
});

document.getElementById("newImageForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const out = document.getElementById("imageResult");
  out.innerHTML = "Gerando...";
  try{
    const cid = e.target.character_id.value.trim();
    const data = await postForm(`/api/character/${cid}/image`, e.target);
    out.innerHTML = `
      <p class="ok"><b>Imagem gerada!</b> (mÃ©todo: ${data.method})</p>
      <img src="${data.image}" style="max-width:420px;border-radius:12px" />
      <p><a href="${data.download}">Baixar imagem</a></p>
    `;
  }catch(err){
    out.innerHTML = `<pre>${JSON.stringify(err,null,2)}</pre>`;
  }
});

document.getElementById("videoForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const out = document.getElementById("videoResult");
  out.innerHTML = "Enviando...";
  try{
    const cid = e.target.character_id.value.trim();
    const data = await postForm(`/api/character/${cid}/video`, e.target);
    out.innerHTML = `<pre>${JSON.stringify(data,null,2)}</pre>`;
  }catch(err){
    out.innerHTML = `<pre>${JSON.stringify(err,null,2)}</pre>`;
  }
});
</script>
</body>
</html>
